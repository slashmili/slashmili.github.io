
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>/mili</title>
  <meta name="author" content="Milad Rastian">

  
  <meta name="description" content="In an application we had many connection to MySQL database to insert and select data.Always MySQL cup usage was about 30%, I googled and found a &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://slashmili.org/blog/page/3">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="/mili" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='https://fonts.googleapis.com/css?family=Noto+Serif:400,700' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-45055199-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">/mili</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  
  
</ul>

<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/talks/">Talks</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/03/monitor-slow-queries-in-mysql/">Monitor Slow Queries in MySQL</a></h1>
    
    
      <p class="meta">
        








  



<time datetime="2009-11-03T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
In an application we had  many connection to  MySQL database to insert and select data.<div>Always MySQL cup usage was about 30%, I googled and found a MySQL option which store slow queries in a log file.</div><div>That&#8217;s awesome !  </div><div>You should add log-slow-queries to file /etc/my.cnf and restart MySQL service and here it is !</div><div><br /></div><div>Go and check around ! make a tea for your self and after a while check log file in /var/run/mysqld/mysqld-slow.log</div><div><br /></div><div>You can read more about this config in <a href="http://dev.mysql.com/doc/refman/5.1/en/slow-query-log.html">MySQL Reference</a> </div></div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/09/12/asterisks-ami-return-empty-string/">Asterisk&#8217;s AMI Return Empty String</a></h1>
    
    
      <p class="meta">
        








  



<time datetime="2009-09-12T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
About 2 months a ago, one day server of our customer decided to response empty string on <a href="http://www.voip-info.org/wiki/view/Asterisk+Manager+API+Action+Command">Command Action</a>. we feed bunch of data for reporting with AMI and especially with Command Action.<div><br /><div>It was so mystery for us ! what happen suddenly ? anyway we were lucky, we had a backup and moved server to backup ones.</div><div><br /></div><div>After works on that server we discovered this problem solved when we run asterisk as a root !</div><div>Anyway we did not work on that server until today. I get asterisk source code and debug lines and found a problem :</div><div>For unknown reason ownership of /tmp was different from always and a function wants to create temporary file but could not access to /tmp (file main/manager.c about line 1736).</div><div><br /></div><div>If Asterisk Developers checks  return value of mkstemp and debug if value is -1, life would be more pleasure </div></div></div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/09/10/asterisks-chanspy-is-out-of-sync/">Asterisk&#8217;s Chanspy Is Out of Sync</a></h1>
    
    
      <p class="meta">
        








  



<time datetime="2009-09-10T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
About 3 month ago we had a problem on ChanSpy in Asterisk. sounds were out of sync.<div>We do everything ! changing asterisk version, compiling different version of asterisk ! </div><div>Users of that customer use EyeBeam as SIP Client, in asterisk bug tracker someone wrote there is a problem with onboard sound cards. so that we take a PAP2 and test ChanSpy with ordinary telephone and Bingoo ! everything was sync !</div><div><br /></div><div>We did update  EyeBeams and problem solved.</div><div><br /></div><div>These days I have problem like before, this time problem is files which recorded by MixMonitor are out of sync. tomorrow I am going to take PAP2 to that location and test files. I hope problem solves by changing EyeBeam or even add PCI sound card.</div><div><br /></div><div>I will update this post when get answer.<span style="font-weight: bold;"><br />Update<span style="font-weight: bold;"> : </span></span><span><br />problem solved by updating asterisk to 1.4.27.3</span><span style="font-weight: bold;"><span style="font-weight: bold;"></span> !<br /><span style="font-weight: bold;"><span style="font-weight: bold;"><span style="font-weight: bold;"></span></span></span><br /></span></div></div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/09/08/hylafax-t30-t1-timeout-problem/">Hylafax T.30 T1 Timeout Problem</a></h1>
    
    
      <p class="meta">
        








  



<time datetime="2009-09-08T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
I configured  iaxmodem and hylafax for on of our customer last week. I test FAX with sending fax internal extensions and everything worked prefect.<div>But today they called me and said they have a problem in sending and receiving FAX ! Again troubleshooting !</div><div><br /></div><div>I checked out log file log file was :</div><div><span class="Apple-style-span" style="font-weight: bold;">SEND FAILED: JOB 4 DEST 88276650 ERR [126] No receiver protocol (T.30 T1 timeout)</span><br /></div><div><br /></div><div>I googled about this problem and there was no direct answer to this. someone said there is a problem on connection your device and you have some thing like &#8220;UDP being a lossy medium&#8221;.</div><div><br /></div><div>Anyway after question from friends problem solved with changing <a href="http://www.quintum.com/">Tenor</a> configure:</div><div><br /><code>#config<br />#iprg<br />#set FaxRelay G.711 Mu-Law</code></div><div><br /></div>If you have a same problem set FaxRelay to Mu-Law maybe cause to solve yours.<br /><div><br /></div></div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/09/08/how-to-config-slave-dns-server/">How to Config Slave DNS Server</a></h1>
    
    
      <p class="meta">
        








  



<time datetime="2009-09-08T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
In a project we have servers which were in different cities, and they connected to each other with Radio connection.<div>We want to setup DNS server in each server for easy use, but configuring dns in each server was to painful if server of one IP changed. we should change config in all server.</div><div><br /></div><div>So I setup a master DNS server and config other server as Slave.</div><div>Slave config is :</div><div><br /></div><div><div>zone &#8220;sip.server.loc&#8221;{</div><div>        type slave;</div><div>        file &#8220;/etc/bind/sip.server.loc&#8221;;</div><div>        masters {172.16.20.1;};</div><div>};</div><div><br /></div><div>Setting file value is useful when Master server is not accessible and Slave response requests with last config file(which updated that file from Master)</div></div></div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/08/30/create-custom-snmp-tree-with-bash/">Create Custom SNMP Tree With Bash</a></h1>
    
    
      <p class="meta">
        








  



<time datetime="2009-08-30T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
In some case you need to monitor your service, and SNMP is ROCKs in reporting.<div>But if you don&#8217;t like to read bunch of document about SNMP protocol and creating server flow this instructions.</div><div><br /></div><div>snmpd helps you so much with <b>pass</b> config, it run your command when request comes for  a exact MIB.</div><div>Just open /etc/snmpd.conf and add this line to end of config file :</div><div><div><code>pass .1.3.6.1.4.1.2021.256  /bin/sh /usr/local/snmp_script/snmp_asterisk</code></div><div><br /></div><div>With this config when you request snmp walk on .1.3.6.1.4.1.2021.256 returns this result :</div><code>$ snmpwalk -v 1 pbx -c public .1.3.6.1.4.1.2021.256<br />UCD-SNMP-MIB::ucdavis.256.1 = Gauge32: 3<br />UCD-SNMP-MIB::ucdavis.256.2 = Gauge32: 10<br />UCD-SNMP-MIB::ucdavis.256.3 = Gauge32: 1<br />UCD-SNMP-MIB::ucdavis.256.4 = Gauge32: 3<br />UCD-SNMP-MIB::ucdavis.256.5 = Gauge32: 3<br /></code><br /><div>Yes ! I monitored my asterisk&#8217;s important status.</div><div>Now what&#8217;s line of that bash script ? you can <b>locate passtest </b>and create your file from that sample but I put my file for more sample !</div></div><code>#!/bin/sh -f<br />PATH=$path:/bin:/usr/bin:/usr/ucb:/usr/local/snmp_script/<br />PLACE=".1.3.6.1.4.1.2021.256"<br />REQ="$2"<br /><br />if [ "$1" = "-s" ]; then<br />echo $* >> /tmp/passtest.log<br />exit 0<br />fi<br /><br />if [ "$1" = "-n" ]; then<br />case "$REQ" in<br />$PLACE)      RET=$PLACE.1 ;;<br />$PLACE.1)    RET=$PLACE.2 ;;<br />$PLACE.2)  RET=$PLACE.3 ;;<br />$PLACE.3)    RET=$PLACE.4 ;;<br />$PLACE.4)    RET=$PLACE.5 ;;<br />*)           exit 0 ;;<br />esac<br />else<br />case "$REQ" in<br />$PLACE)    exit 0 ;;<br />*)         RET=$REQ ;;<br />esac<br />fi<br /><br />echo "$RET"<br />case "$RET" in<br />$PLACE.1) echo "gauge"; echo `member_in_queue` ; exit 0 ;;<br />$PLACE.2) echo "gauge"; echo `number_of_answerd_call` ; exit 0 ;;<br />$PLACE.3) echo "gauge"; echo `number_of_missed_call`; exit 0 ;;<br />$PLACE.4) echo "gauge"; echo `rate_answerd_call` ;;<br />$PLACE.5) echo "gauge"; echo `rate_missed_call` ; exit 0 ;;<br />*) echo "string"; echo "ack... $RET $REQ"; exit 0 ;;<br />esac<br /></code><br /><br />You can use this MIBS in Monitoring System like Zenoss and &#8230;</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/08/12/samsung-galaxy-farsi-fonts-and-keyboard/">Samsung Galaxy Farsi Fonts and Keyboard</a></h1>
    
    
      <p class="meta">
        








  



<time datetime="2009-08-12T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
After I change my G1 fonts to read farsi SMS and also farsi keyboard some one post me a comment which want from me to check if I could do same things on his <a href="http://tinyurl.com/lylnp2">Samsung Galaxy</a> .<div><br /></div><div>And now I do that staff. rooting Samsung Galaxy was bit little more difficult  than G1 !</div><div><br /></div><div><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://rastian.com/mili/blog/uploaded_images/samsung_galaxy_persian-730788.png"><img src="http://rastian.com/mili/blog/uploaded_images/samsung_galaxy_persian-730786.png" border="0" alt="" style="cursor: pointer; width: 133px; height: 200px; " /></a><br /></div><div><br /></div><img src="http://anddev.ir/uploads/persian_keyboard_android0.png" /><div><br /></div></div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/06/17/how-to-use-libjalali/">How to Use Libjalali</a></h1>
    
    
      <p class="meta">
        








  



<time datetime="2008-06-17T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
About 2 years ago my friend <a href="http://ashkan.selfip.org/">Ashkan Ghassemi</a> developed a <a href="https://savannah.nongnu.org/projects/jcal">Jalali Calender</a> for use in terminal and as Eric S. Raymond says in his book <span style="font-weight: bold;">The Art of Unix Programming</span> : &#8220;Write simple parts connected by clean interfaces&#8221;, Ashkan  followed Raymond and create beautiful program .<br /><br />In a project I need to use that library so I get source file and install it, but there was no any documentation for developer. here I write fast tutorial :<br /><br /><code><font color="0000ff"><strong>#include<font color="#008000">&lt;jalali.h&gt;</font></strong></font><br /><font color="0000ff"><strong>#include<font color="#008000">&lt;stdio.h&gt;</font></strong></font><br /><strong>int</strong> <font color="#2040a0">main</font> <font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF"><strong>{</strong></font><br /><font color="#2040a0">j_date</font> <font color="#2040a0">jcal</font><font color="4444FF">;</font><font color="#2040a0">calc_current</font><font color="4444FF">(</font><font color="4444FF">&amp;</font><font color="#2040a0">jcal</font><font color="4444FF">)</font> <font color="4444FF">;</font><br /><font color="#2040a0">printf</font><font color="4444FF">(</font><font color="#008000">&quot;curentdate is :%d/%d/%d<font color="#77dd77">\n</font> &quot;</font>,<font color="#2040a0">jcal</font>.<font color="#2040a0">year</font>,<font color="#2040a0">jcal</font>.<font color="#2040a0">month</font>,<font color="#2040a0">jcal</font>.<font color="#2040a0">day</font><font color="4444FF">)</font><font color="4444FF">;</font><font color="4444FF"><strong>}</strong></font><br /></code><br />and after that compile this code :<br />cc jcaltest.c -I/usr/local/include/jalali/ -L/usr/local/lib/ -ljalali -o jalal.bin<br /><br />and run jalal.bin</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/06/02/configure-asterisk-and-zaptel-on-ubuntu/">Configure Asterisk and Zaptel on Ubuntu 6.*</a></h1>
    
    
      <p class="meta">
        








  



<time datetime="2008-06-02T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
Always I installed <a href="http://www.asterisk.org/">Asterisk</a> and <a href="http://www.zaptel.com">Zaptel</a> on Ubutnu 6.*, I got a error and couldn&#8217;t find  any files in folder /dev/zap/ !<br />Actually he said true ! because Zaptel file was in /dev/ folder.<br />When servers restart, I should create link to real device file(I try put this command on file rc.local but still had a problem on creating link). Until I goggled and find some manual for this problem.our problem will solved by udev.<br /><br />Create File : /etc/udev/rules.d/50-udev.rules<br /><code><br />KERNEL="zapctl",     NAME="zap/ctl" , GROUP = "asterisk"<br />KERNEL="zaptimer",   NAME="zap/timer" , GROUP = "asterisk"<br />KERNEL="zapchannel", NAME="zap/channel" , GROUP = "asterisk"<br />KERNEL="zappseudo",  NAME="zap/pseudo" , GROUP = "asterisk"<br />KERNEL="zap[0-9]*",  NAME="zap/%n" , GROUP = "asterisk"<br /></code><br /><br />Restart udev : /etc/init.d/udev restart<br /><br />Now every time server restart udev create device in place where Asterisk wanted.</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/05/04/script-for-removing-changed-host/">Script for Removing Changed Host Identification</a></h1>
    
    
      <p class="meta">
        








  



<time datetime="2008-05-04T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
As I am working as a system administer this days and always had a problem with changing Remote Identification of servers, I write simple script which you can delete a line from your ~/.ssh/known_hosts<br /><br /><code><br />#!/bin/bash<br />#rm_known_hosts bash script<br />tmp_head=$(mktemp)<br />tmp_tail=$(mktemp)<br />tmp_dest=$(mktemp)<br /><br />file_name="$HOME/.ssh/known_hosts"<br />line_nums=$(cat $file_name | wc -l )<br /><br />cat $file_name | head -n`echo "$1 -1 " | bc ` > $tmp_head<br />cat $file_name | tail -n`echo "$line_nums - $1 "| bc` > $tmp_tail<br /><br />cat $tmp_head  > $tmp_dest<br />cat $tmp_tail >> $tmp_dest<br /><br />cp $tmp_dest $file_name<br /><br />#remove tmps<br />rm -f $tmp_head<br />rm -f $tmp_tail<br />rm -f $tmp_dest<br /></code><br /><br />for example run when you got error like this : <br /><code><br />@@@@@@@@@@@@@@@@@@@@@@@@@@@@@<br />@ WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!<br />@@@@@@@@@@@@@@@@@@@@@@@@@@@@@<br />IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!<br />Someone could be eavesdropping on you right now (man-in-the-middle attack)!<br />It is also possible that the RSA host key has just been changed.<br />The fingerprint for the RSA key sent by the remote host is<br />ac:2c:99:de:a6:f4:7d:4a:81:93:7e:9c:67:a6:14:45.<br />Please contact your system administrator.<br />Add correct host key in /root/.ssh/known_hosts to get rid of this message.<br />Offending key in /root/.ssh/known_hosts:90<br />RSA host key for 10.10.10.10 has changed and you have requested strict checking.<br />Host key verification failed.<br /></code><br /><br />you just run<br /><code><br />./rm_known_hosts 90<br /></code><br />Life will be essayer with tiny scripts !</div>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/4/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/2/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
   
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:slashmili.org" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
  
    <section>
  <h1>About Me</h1>
  <p>You&#8217;ve reached Milad!<br/ >I&#8217;m software enthusiast and interested in free software movement.</p>
  <p>You may find more interesting stuff on my <a href="http://linkedin.com/in/miladrastian">Linkedin</a>, <a href="https://github.com/slashmili">Github</a> or <a href="https://twitter.com/slashmili">Twitter</a> pages.</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/03/11/error-handling-the-elixir-way/">Error Handling, the Elixir Way</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/02/06/elixir/">Elixir</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/07/find-and-replace-regex-group-match-in-vim/">Find and Replace Regex Group Match in VIM</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/11/23/dependency-manager-for-php/">Dependency Manager for PHP</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/06/16/debugging-application-crash-in-linux/">Debugging Application Crash in Linux</a>
      </li>
    
  </ul>
</section>




  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Milad Rastian -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



<script>
  $(document).ready(function() {  
    var stickyNavTop = $('nav').offset().top;  
      
    var stickyNav = function(){  
      var scrollTop = $(window).scrollTop(); 
      var navHasClassSticky = $('nav').hasClass('sticky');

      if (scrollTop > stickyNavTop && navHasClassSticky) {   
        return true;
      } else if (scrollTop > stickyNavTop) {
        $('nav').hide();
        $('nav').addClass('sticky');
        $('nav').fadeIn('2000');
      } else {  
        $('nav').removeClass('sticky');   
      }  
    };  
      
    stickyNav();  
      
    $(window).scroll(function() {  
      stickyNav();  
    });  
  });  
</script>


</body>
</html>
